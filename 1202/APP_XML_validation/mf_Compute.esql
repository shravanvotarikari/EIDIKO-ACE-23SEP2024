

CREATE COMPUTE MODULE mf_Compute
	CREATE FUNCTION Main() RETURNS BOOLEAN
	BEGIN
		
	
		if InputRoot.XMLNSC.Root.Header.channelId <> 'FCR' and  InputRoot.XMLNSC.Root.Header.channelId <> 'TPH' then
			throw user EXCEPTION values('invalid channel');
		end if;

		set OutputRoot = InputRoot;
		
		declare outref REFERENCE to OutputRoot.XMLNSC.Root.Body;
		
		IF FIELDNAME(outref.*) <> 'Data'  THEN
			
			declare bookref reference to  InputRoot.XMLNSC.Root.Body.*.book[1];
			DECLARE i INTEGER 1;
			WHILE LASTMOVE(bookref) DO
			
				if bookref.author <> 'Corets, Eva' then
					set OutputRoot.XMLNSC.Root.Body.*.*[i] = null;
					set i = i-1;
				End if;
				set i = i+1;
				move bookref NEXTSIBLING;
				
			END WHILE;
			
		ELSE
			declare bookref reference to outref.Data.*.book;
			DECLARE i INTEGER 1;
			WHILE LASTMOVE(bookref) DO
			
				if bookref.author <> 'Corets, Eva' then
					set OutputRoot.XMLNSC.Root.Body.Data.*.*[i] = null;
				End if;
				
				set i = i+1;
				move bookref NEXTSIBLING;
			END WHILE;
			
		END IF;
		
	
		
		RETURN TRUE;
	END;

create PROCEDURE setqueue (in ch CHARACTER )
BEGIN
		if ch = 'FCR' then
			set OutputLocalEnvironment.Destination.MQ.DestinationData.queueName = 'FCR';
		elseif ch = 'TPH' then
			set OutputLocalEnvironment.Destination.MQ.DestinationData.queueName = 'TPH';
		end if;
END;
END MODULE;
